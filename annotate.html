<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>1. Select a Manifest</title>
  <meta name="description" content="">

  
  
  <link rel="stylesheet" href="http://marii.info/annotate/assets/style.css">

  <link rel="canonical" href="http://marii.info/annotate/">

  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>


  <body>

    <header class="border-bottom-thick px-2 clearfix" style="position: fixed;top:0;width: 100%;background-color:#fff;">
  <div class="left sm-width-full py-1 mt-1 mt-lg-0">
    <a class="align-middle link-primary text-accent" href="/annotate/">
      IIIF Annotation Demo
    </a>
  </div>
  <div class="right sm-width-full">
    <ul class="list-reset mt-lg-1 mb-2 mb-lg-1">
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="#1">
            1. Select a Manifest
          </a>
        </li>
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="#2">
            2. Add Annotations
          </a>
        </li>
        <li class="inline-block">
          <a class="align-middle link-primary mr-2 mr-lg-0 ml-lg-2" href="#3">
            3. Store Annotations
          </a>
        </li>
    </ul>
  </div>
</header>


    <div>
      <article class="container mx-auto px-2 mt2 mb4">
  <header>
    <h1 class="h0 py-4 mt-3">1. Select a Manifest</h1>
  </header>
  <div class="col-4 sm-width-full border-top-thin">
  </div>
  <div class="prose mb-4 py-4">
    <script src="https://use.fontawesome.com/884e80fbb8.js"></script>

<div id="1" style="position:absolute;top:0px;"></div>

<p>Sample pre-loaded annotations can be viewed by toggling the <i class="fa fa-comments" aria-hidden="true"></i> button on the top left of the viewer.</p>

<iframe title="Mirador" class="iiif_presentation" allowtransparency="true" src="iiif_mirador.html" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true" style="width: 100%; height: 600px;margin:40px 0px 20px 0px;" srcdoc="&lt;link rel='stylesheet' type='text/css' href='/annotate/build/mirador/css/mirador-combined.css'&gt;
&lt;style&gt;#viewer {width: 100%;}&lt;/style&gt;
&lt;div id='viewer'&gt;&lt;/div&gt;

&lt;script src='/annotate/build/mirador/mirador.js'&gt;&lt;/script&gt;
&lt;script type='text/javascript'&gt;
   $(function() {
     myMiradorInstance = Mirador({
       id: 'viewer',
       data: [

	{ manifestUri: 'http://marii.info/annotate/iiif/copperfield/manifest.json' }, 

	{ manifestUri: 'http://marii.info/annotate/iiif/bnf640/manifest.json' }, 

	{ manifestUri: 'http://marii.info/annotate/iiif/haemisphaerium/manifest.json' }

],
       windowObjects: [{
           loadedManifest: 'http://marii.info/annotate/iiif/copperfield/manifest.json',
           canvasID: '',
           bottomPanelVisible: true
       }],
       annotationEndpoint: { 'name':'Local Storage', 'module': 'LocalStorageEndpoint' }
     });
   });
&lt;/script&gt;">
</iframe>

<p>Switch between objects by clicking <i class="fa fa-th-large"></i> in the top left corner, followed by Replace Object <i class="fa fa-refresh"></i>.</p>

<div id="2"></div>
<h1 class="h0">2. Add Annotations</h1>
<p><br /></p>
<div class="col-4 sm-width-full border-top-thin"></div>
<p><br /></p>

<p>Make sure you are on Image View <i class="fa fa-photo"></i> then toggle the Annotation <i class="fa fa-comments"></i> panel.</p>

<p>Add one or more annotations to one or more pages. Then click the ‘view cached annotation JSON’ button below.</p>

<p><strong>*Note:</strong> This will only include <em>new</em> annotations added in the browser.</p>

<p><br /></p>

<style>
  .anno{max-width:800;overflow:scroll;padding:10px;margin-top:10px;}
</style>

<p><br />
<button type="button" id="anno_button">View cached annotation JSON</button></p>
<div id="anno_results"></div>
<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

<script type="text/jscript">
  var canvas_regex = /.+canvas\/([^.]+)/;

  function download(filename, text) {
    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', filename);
    element.style.display = 'none';
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
  }
  var safetext = function(text){
  	var table = {
  		'<': 'lt',
  		'>': 'gt',
  		'"': 'quot',
  		'\'': 'apos',
  		'&': 'amp',
  		'\r': '#10',
  		'\n': '#13'
  	};

  	return text.toString().replace(/[<>"'\r\n&]/g, function(chr){
  		return '&' + table[chr] + ';';
  	});
  };

  $(document).ready(function(){
    $( "#anno_button" ).click(function() {
      $( "#anno_results" ).empty()
      for(var i =0; i < localStorage.length; i++){
        var key = localStorage.key(i);
        var matches = canvas_regex.exec(key);
        if(matches != null) {
          var canvas = matches[1];
          var fileName = canvas + '.json';
          var fileContent = localStorage.getItem(key);
          if (fileContent.length > 2) {
            $("#anno_results").append("<div class='anno'></div>" )
                              .append("<h1 class='file'>" + canvas + "</h1>")
                              .append("<textarea rows='30' cols='100' id='" + canvas + "-content'>"+ safetext(fileContent))
                              .append("<br><button type='button' id='" + canvas +"' class='download-button'>Download " + fileName + "</button>");
          }
        }
      }
      $(".download-button").click(function(){
        var content_id = this.id + "-content";
        var text = document.getElementById(content_id).value;
        var file = this.id + ".json"
        download(file, text);
      });
    });
  });
</script>

<div id="3"></div>
<h1 class="h0">3. Store Annotations</h1>
<p><br /></p>
<div class="col-4 sm-width-full border-top-thin"></div>
<p><br /></p>

<iframe width="100%" height="500" src="https://www.youtube-nocookie.com/embed/nHbsm8T1BnI?rel=0&amp;showinfo=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen=""></iframe>
<p><br /><br /></p>

<p><strong>1.</strong> Make sure you a running a modern version of Ruby (v2 or later) and have <strong><a href="https://jekyllrb.com/">Jekyll</a></strong> installed.</p>

<p><strong>2.</strong> Clone the <strong><a href="https://github.com/mnyrop/bnf640">demo site repository</a></strong> onto your local machine and open it in a text editor like <strong><a href="https://atom.io/">Atom</a></strong>.</p>

<p><strong>3.</strong> Serve the site locally by moving into the site directory and running
<code class="highlighter-rouge">$ bundle install &amp;&amp; bundle exec jekyll serve</code></p>

<p><strong>4.</strong> Add some new annotations by following <strong><a href="/annotate/#2">the instructions above</a></strong>.</p>

<p><strong>5.</strong> Continue to add or delete annotations. When you are ready, click ‘view cached annotation JSON’ again then download the data for each canvas.</p>

<p><strong>6.</strong> Clear the cached annotations from your browser storage. (In Chrome, right click &gt; Inspect &gt; Application &gt; Clear Storage &gt; Clear site data). Your annotations will be gone at this point.</p>

<p><strong>7.</strong> Stop the Jekyll serve command. (CTRL-C on Mac)</p>

<p><strong>8.</strong> Drag the downloaded JSON files into correct folder within the <code class="highlighter-rouge">annotation</code> annotation directory of the demo site repository. (Either <code class="highlighter-rouge">bnf640</code> or <code class="highlighter-rouge">haemisphaerium</code>. Do not put them into any subfolders.)</p>

<p><strong>9.</strong> Run <code class="highlighter-rouge">$ bundle exec rake</code>. This will store your annotations in subfolders and create a copy of the IIIF manifest that will reference them.</p>

<p><strong>10.</strong> Serve the site again with <code class="highlighter-rouge">$ bundle exec jekyll serve</code>. Your annotations will be back and permanent!</p>

<p><strong>11.</strong> Want to add more annotations? Follow the same process and drag new files into the <code class="highlighter-rouge">annotations</code> folder. This will not overwrite any existing annotation data.</p>

  </div>
</article>

    </div>

    <div class="border-top-thin clearfix mt-2 mt-lg-4">
  <div class="container mx-auto px-2">
    <p class="col-8 sm-width-full left py-2 mb-0">This project is maintained by <a class="text-accent" href="https://github.com/mnyrop">mnyrop</a></p>
    <ul class="list-reset right clearfix sm-width-full py-2 mb-2 mb-lg-0">
      <li class="inline-block mr-1">
        <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="IIIF Annotation Demo">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      <li class="inline-block">
        <a class="github-button" href="https://github.com/mnyrop/" data-icon="octicon-star" data-count-href="mnyrop//stargazers" data-count-api="/repos/mnyrop/#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star mnyrop/ on GitHub">Star</a>
      </li>
    </ul>
  </div>
</div>


  </body>

</html>
